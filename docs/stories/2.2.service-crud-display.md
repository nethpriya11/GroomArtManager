# Story 2.2: Service CRUD - Display Service Catalog

## Status

Draft

## Story

**As a** manager or barber,
**I want** to see all available services in a grid layout,
**so that** I know what services the salon offers.

## Acceptance Criteria

1. Services page displays all services from Firestore `services` collection in real-time (onSnapshot)
2. Services shown as cards in a responsive grid: 3 columns (desktop >1024px), 2 columns (tablet 768-1024px), 1 column (mobile <768px)
3. Each card displays: Service name (heading), Price (formatted as $XX.XX), Duration (XX minutes)
4. Cards styled with dark theme (#1a1a1a background, #2a2a2a border, rounded corners)
5. Hover state: Card elevates slightly (2px translate, shadow increase)
6. Real-time updates: New services appear instantly, deleted services disappear instantly
7. Empty state shown if no services: "No services yet. Add a service to get started." (managers only)
8. Barbers see read-only service cards (no edit/delete options)
9. Skeleton loading state shown on initial page load
10. Services sortable by name (alphabetical) - default sort order

## Tasks / Subtasks

- [ ] Set up real-time Firestore listener (AC: 1, 6)
  - [ ] Create `useServices()` hook in `hooks/useServices.ts`
  - [ ] Implement Firestore onSnapshot listener for `services` collection
  - [ ] Wrap listener in React Query for subscription management and cleanup
  - [ ] Ensure real-time updates: new/deleted services appear/disappear instantly
- [ ] Implement responsive service grid layout (AC: 2)
  - [ ] Create `ServiceGrid.tsx` component in `components/features/services/`
  - [ ] Use Tailwind grid classes: 3 columns (lg:grid-cols-3), 2 columns (md:grid-cols-2), 1 column (grid-cols-1)
  - [ ] Configure breakpoints: desktop >1024px, tablet 768-1024px, mobile <768px
- [ ] Create service card component (AC: 3, 4, 5)
  - [ ] Create `ServiceCard.tsx` component in `components/features/services/`
  - [ ] Display: Service name (heading), Price (formatted $XX.XX), Duration (XX minutes)
  - [ ] Apply dark theme styling: #1a1a1a background, #2a2a2a border, rounded corners
  - [ ] Implement hover state: 2px translate-y, shadow increase (shadow-lg on hover)
- [ ] Implement role-based rendering (AC: 8)
  - [ ] Check user role from auth store
  - [ ] Show edit/delete options for managers only
  - [ ] Render read-only cards for barbers (no action menu)
- [ ] Add empty state component (AC: 7)
  - [ ] Create `EmptyState.tsx` component in `components/features/common/`
  - [ ] Display: "No services yet. Add a service to get started." (managers only)
  - [ ] Barbers see different message if applicable
- [ ] Implement skeleton loading state (AC: 9)
  - [ ] Create `ServiceCardSkeleton.tsx` component
  - [ ] Display skeleton cards while data is loading
  - [ ] Use ShadCN Skeleton component
- [ ] Add service sorting (AC: 10)
  - [ ] Sort services alphabetically by name (default)
  - [ ] Implement sorting logic in useServices hook or component

## Dev Notes

### Real-time Data Synchronization Pattern

[Source: architecture.md#Architectural Patterns - Real-time Data Synchronization]

Wrap Firestore onSnapshot listeners in React Query for automatic subscription management:

```typescript
import { collection, onSnapshot, query, orderBy } from 'firebase/firestore'
import { useQuery } from '@tanstack/react-query'
import { db } from '@/lib/firebase/config'
import type { Service } from '@/types/firestore'

export function useServices() {
  return useQuery({
    queryKey: ['services'],
    queryFn: () =>
      new Promise<Service[]>((resolve, reject) => {
        const q = query(collection(db, 'services'), orderBy('name', 'asc'))
        const unsubscribe = onSnapshot(
          q,
          (snapshot) => {
            const services = snapshot.docs.map(
              (doc) =>
                ({
                  id: doc.id,
                  ...doc.data(),
                }) as Service
            )
            resolve(services)
          },
          (error) => reject(error)
        )
        // Cleanup function
        return () => unsubscribe()
      }),
    staleTime: Infinity, // Real-time data never stale
  })
}
```

### Responsive Grid Layout

[Source: Epic 2 AC: 2]

Use Tailwind CSS grid utilities with breakpoint modifiers:

```tsx
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  {services.map((service) => (
    <ServiceCard key={service.id} service={service} />
  ))}
</div>
```

Breakpoints:

- Mobile (<768px): 1 column
- Tablet (768-1024px): 2 columns
- Desktop (>1024px): 3 columns

### Service Card Styling

[Source: Epic 2 AC: 3, 4, 5]

Dark theme with hover effects:

```tsx
<div className="bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 transition-all hover:-translate-y-0.5 hover:shadow-lg">
  <h3 className="text-lg font-semibold">{service.name}</h3>
  <p className="text-amber-500 text-xl font-bold">
    ${service.price.toFixed(2)}
  </p>
  <p className="text-gray-400">{service.duration} minutes</p>
</div>
```

### Role-Based Access Control

[Source: architecture.md#Architectural Patterns - RBAC]

Check user role for conditional rendering:

```typescript
import { useAuth } from '@/hooks/useAuth';

function ServiceCard({ service }) {
  const { user } = useAuth();
  const isManager = user?.role === 'manager';

  return (
    <div className="relative">
      {/* Card content */}
      {isManager && (
        <DropdownMenu>
          {/* Edit/Delete options */}
        </DropdownMenu>
      )}
    </div>
  );
}
```

### Price Formatting

[Source: architecture.md#Coding Standards]

Use consistent currency formatting:

```typescript
// In lib/utils/format.ts
export function formatCurrency(amount: number): string {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
  }).format(amount)
}
```

### Component Structure

[Source: architecture.md#Unified Project Structure]

File locations:

- Hook: `hooks/useServices.ts`
- Grid component: `components/features/services/ServiceGrid.tsx`
- Card component: `components/features/services/ServiceCard.tsx`
- Skeleton: `components/features/services/ServiceCardSkeleton.tsx`
- Empty state: `components/features/common/EmptyState.tsx`

### Testing

#### Unit Tests

[Source: architecture.md#Testing Strategy]

**useServices Hook Test** (`tests/unit/hooks/useServices.test.ts`):

- Mock Firestore onSnapshot listener
- Test hook returns services array
- Test services sorted alphabetically by name
- Test hook handles empty collection
- Test hook cleans up listener on unmount
- Test hook handles Firestore errors

#### Component Tests

[Source: architecture.md#Testing Strategy]

**ServiceGrid Test** (`tests/component/services/ServiceGrid.test.tsx`):

- Test grid renders all services from useServices hook
- Test responsive grid classes applied correctly
- Test empty state displays when no services
- Test skeleton loading state displays while loading
- Test services sorted alphabetically

**ServiceCard Test** (`tests/component/services/ServiceCard.test.tsx`):

- Test card displays service name, price, duration
- Test price formatted as $XX.XX
- Test duration displays with "minutes" label
- Test dark theme styles applied
- Test hover state (can verify class presence)
- Test managers see dropdown menu
- Test barbers don't see dropdown menu

#### E2E Tests

[Source: architecture.md#Testing Strategy]

**Service Display E2E** (`tests/e2e/service-management.spec.ts`):

- Test manager navigates to /manager/services and sees service grid
- Test barber navigates to services page and sees read-only cards
- Test services display with correct information (name, price, duration)
- Test responsive layout at different viewport sizes
- Test empty state displays when no services exist
- Test real-time updates: create service in one browser, appears in another instantly

## Change Log

| Date       | Version | Description            | Author          |
| ---------- | ------- | ---------------------- | --------------- |
| 2025-10-10 | v1.0    | Initial story creation | PM Agent (John) |

## Dev Agent Record

### Agent Model Used

{To be populated by dev agent}

### Debug Log References

{To be populated by dev agent}

### Completion Notes List

{To be populated by dev agent}

### File List

{To be populated by dev agent}

## QA Results

{To be populated by QA agent}
