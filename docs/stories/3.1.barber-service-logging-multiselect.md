# Story 3.1: Barber Service Logging - Multi-Select UI

## Status

Draft

## Story

**As a** barber,
**I want** to select multiple completed services from a grid,
**so that** I can log them all at once instead of one at a time.

## Acceptance Criteria

1. Barber dashboard "Log a Service" section displays all services from Firestore as selectable cards
2. Cards show: Service name, Price, Duration
3. Cards are clickable/tappable (entire card is touch target, minimum 44x44px)
4. Selected state indicated by: Primary color ring border (2-3px #f59e0b), subtle background tint
5. Multiple cards can be selected simultaneously
6. Keyboard support: Tab to navigate cards, Space bar to toggle selection
7. Selection count displayed in "Log Service" button: "Log Service" (if 0 selected) or "Log 3 Service(s)" (if 3 selected)
8. Button disabled if no services selected
9. Clicking a selected card deselects it (toggles selection state)
10. Selection persists until "Log Service(s)" clicked or page refreshed

## Tasks / Subtasks

- [ ] Create ServiceCard component with selection support (AC: 1, 2, 3, 4, 5, 9)
  - [ ] Build ServiceCard component in `components/features/services/ServiceCard.tsx`
  - [ ] Display service name, price, duration using ShadCN Card component
  - [ ] Implement click handler for entire card (minimum 44x44px touch target)
  - [ ] Add selected state styling: primary color ring border (2-3px #f59e0b), subtle background tint
  - [ ] Add toggle selection logic (clicking selected card deselects it)
- [ ] Implement keyboard navigation support (AC: 6)
  - [ ] Add Tab key navigation support between cards
  - [ ] Add Space bar handler to toggle selection
  - [ ] Include proper ARIA labels and role="button" attribute
  - [ ] Set tabIndex={0} for keyboard focusability
- [ ] Create ServiceGrid component for multi-select UI (AC: 1, 5, 10)
  - [ ] Build ServiceGrid component in `components/features/services/ServiceGrid.tsx`
  - [ ] Use useServices hook to fetch all services from Firestore
  - [ ] Maintain local state for selected service IDs (useState<string[]>)
  - [ ] Map services to ServiceCard components with selection handlers
  - [ ] Persist selection state until "Log Service(s)" clicked or page refreshed
- [ ] Build dynamic "Log Service" button (AC: 7, 8)
  - [ ] Display selection count in button: "Log Service" (0 selected) or "Log 3 Service(s)" (3 selected)
  - [ ] Disable button when no services selected (disabled={selectedServices.length === 0})
  - [ ] Use ShadCN Button component with primary variant
- [ ] Integrate into Barber Dashboard (AC: 1)
  - [ ] Add "Log a Service" section to barber dashboard page
  - [ ] Import and render ServiceGrid component
  - [ ] Pass selectedServices state to logging service (for Story 3.2)

## Dev Notes

### Component Architecture

[Source: architecture.md#Components]

Build following component hierarchy:

- `ServiceCard` (atom): Displays single service with selection state
- `ServiceGrid` (organism): Container managing multi-select logic and service catalog display
- Integrate into `BarberDashboard` (page): Main dashboard page

**Component Location:**

- `components/features/services/ServiceCard.tsx`
- `components/features/services/ServiceGrid.tsx`
- `app/(auth)/barber/dashboard/page.tsx`

### Data Fetching

[Source: architecture.md#Real-time Sync Engine]

Use real-time Firestore query for service catalog:

```typescript
// hooks/useServices.ts
import { useRealtimeQuery } from '@/hooks/useRealtimeQuery'
import { collection, query } from 'firebase/firestore'
import { db } from '@/lib/firebase/config'

export function useServices() {
  return useRealtimeQuery<Service>(
    ['services'],
    query(collection(db, 'services'))
  )
}
```

Services auto-update when managers add/edit/delete services (real-time sync).

### Service Data Model

[Source: architecture.md#Data Models]

```typescript
interface Service {
  id: string
  name: string
  price: number // Dollars (e.g., 25.00)
  duration: number // Minutes
  createdAt: Firestore.Timestamp
}
```

### Styling Requirements

[Source: architecture.md#Technology Stack]

- Use Tailwind CSS with dark theme defaults (#0a0a0a background)
- Primary accent color: #f59e0b (amber)
- Selected state: `ring-2 ring-primary bg-primary/10`
- Use ShadCN Card, Badge components for consistent UI
- Minimum touch target: 44x44px for mobile accessibility

### Accessibility

[Source: architecture.md#Component Template]

- Include `role="button"` on clickable cards
- Add `tabIndex={0}` for keyboard navigation
- Implement `onKeyDown` handler for Space bar toggle
- Set `aria-label` with service details: `${service.name} - $${service.price}`
- Set `aria-pressed={isSelected}` for screen readers

### State Management

[Source: architecture.md#State Management Patterns]

Use local component state (useState) for selected services:

```typescript
const [selectedServices, setSelectedServices] = useState<string[]>([])
```

Server state (services from Firestore) managed by React Query via useServices hook.

### Testing

[Source: architecture.md#Testing Strategy]

**Component Tests (React Testing Library):**

- Test ServiceCard renders service name, price, duration
- Test click handler toggles selection state
- Test keyboard navigation (Tab, Space bar)
- Test selected state styling (ring border, background tint)
- Test aria-pressed attribute updates

**E2E Tests (Playwright):**

- Test barber can select multiple services
- Test selection count updates in button label
- Test button disabled when no services selected
- Test deselection by clicking selected card
- Test keyboard navigation with Tab and Space bar

## Change Log

| Date       | Version | Description            | Author          |
| ---------- | ------- | ---------------------- | --------------- |
| 2025-10-10 | v1.0    | Initial story creation | PM Agent (John) |

## Dev Agent Record

### Agent Model Used

{To be populated by dev agent}

### Debug Log References

{To be populated by dev agent}

### Completion Notes List

{To be populated by dev agent}

### File List

{To be populated by dev agent}

## QA Results

{To be populated by QA agent}
