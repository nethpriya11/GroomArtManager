# Story 1.5: Authentication Flow - Login Page

## Status

Draft

## Story

**As a** user,
**I want** to select my role (Manager or Barber) on a login page,
**so that** I can access the appropriate dashboard for my responsibilities.

## Acceptance Criteria

1. Login page created at `/login` route with responsive layout
2. Dark theme applied (#0a0a0a background) with centered content
3. Two large, touch-friendly buttons displayed: "Manager" and "Barber" (#f59e0b accent color on hover)
4. Manager button click immediately authenticates as the sole manager user and redirects to `/manager/dashboard`
5. Barber button click navigates to barber selection view (same page, different state)
6. Page includes SalonFlow branding/title and brief description
7. Buttons meet WCAG 2.1 Level AA contrast requirements (4.5:1 minimum)
8. Keyboard navigation works (Tab to focus, Enter to select)
9. Loading state displayed during authentication (spinner with optimistic navigation)
10. Error handling shows toast notification if authentication fails

## Tasks / Subtasks

- [ ] Create login page route (AC: 1)
  - [ ] Create `app/login/page.tsx`
  - [ ] Set up Next.js metadata (title: "Login - SalonFlow")
  - [ ] Implement responsive layout structure
  - [ ] Export as default component
- [ ] Apply dark theme styling (AC: 2)
  - [ ] Set background color to #0a0a0a
  - [ ] Center content vertically and horizontally
  - [ ] Use Tailwind dark mode classes
  - [ ] Ensure proper contrast for all text elements
- [ ] Create role selection buttons (AC: 3)
  - [ ] Create two large buttons: "Manager" and "Barber"
  - [ ] Apply #f59e0b accent color on hover
  - [ ] Make buttons touch-friendly (min height 48px)
  - [ ] Use ShadCN Button component
  - [ ] Add icons (optional): User icon for Manager, Users icon for Barber
- [ ] Implement Manager authentication (AC: 4)
  - [ ] Handle Manager button click
  - [ ] Call authentication service to sign in as manager
  - [ ] Update Zustand authStore with manager user
  - [ ] Redirect to `/manager/dashboard` using Next.js router
  - [ ] Show loading state during authentication
- [ ] Implement Barber navigation (AC: 5)
  - [ ] Handle Barber button click
  - [ ] Update component state to show barber selection view
  - [ ] Keep on same route (/login)
  - [ ] Add back button to return to role selection
  - [ ] Animate transition between views (optional)
- [ ] Add SalonFlow branding (AC: 6)
  - [ ] Add "SalonFlow" title/logo at top
  - [ ] Add tagline: "Commission Tracking Made Simple" or similar
  - [ ] Use typography hierarchy (large title, smaller description)
  - [ ] Apply brand colors (#f59e0b for accent)
- [ ] Ensure accessibility (AC: 7)
  - [ ] Verify WCAG 2.1 Level AA contrast (4.5:1 minimum)
  - [ ] Test contrast checker on all text/button combinations
  - [ ] Add aria-labels to buttons
  - [ ] Ensure sufficient color contrast in hover states
- [ ] Implement keyboard navigation (AC: 8)
  - [ ] Verify Tab key focuses buttons in correct order
  - [ ] Verify Enter/Space key activates focused button
  - [ ] Test keyboard-only navigation flow
  - [ ] Add visible focus indicators (ring-2 ring-primary)
- [ ] Add loading state (AC: 9)
  - [ ] Create loading spinner component
  - [ ] Display spinner during authentication
  - [ ] Disable buttons while loading
  - [ ] Show optimistic navigation feedback
  - [ ] Use ShadCN Spinner or custom component
- [ ] Implement error handling (AC: 10)
  - [ ] Wrap authentication in try/catch
  - [ ] Display toast notification on error using Sonner
  - [ ] Show user-friendly error messages
  - [ ] Allow retry after error
  - [ ] Log errors to console (Sentry in production)

## Dev Notes

### Authentication Flow Architecture

[Source: architecture.md#Components - Authentication Service]

**Authentication Pattern:**

- **Manager Login:** Immediate authentication as sole manager user → redirect to `/manager/dashboard`
- **Barber Login:** Navigate to barber selection view → select barber → authenticate → redirect to `/barber/dashboard`

**Authentication Service:**

- `signInAsManager()` - Authenticates sole manager account
- `signInAsBarber(barberId: string)` - Authenticates selected barber
- Uses Firebase Auth with custom claims for role-based access

### Login Page Layout

[Source: epic-1-foundation-authentication.md Story 1.5]

**Page Structure:**

```tsx
<div className="min-h-screen bg-[#0a0a0a] flex items-center justify-center">
  <div className="max-w-md w-full px-6 py-8 space-y-8">
    {/* Branding */}
    <div className="text-center">
      <h1 className="text-4xl font-bold text-white">SalonFlow</h1>
      <p className="text-gray-400 mt-2">Commission Tracking Made Simple</p>
    </div>

    {/* Role Selection Buttons */}
    <div className="space-y-4">
      <Button onClick={handleManagerLogin}>Manager</Button>
      <Button onClick={handleBarberClick}>Barber</Button>
    </div>
  </div>
</div>
```

### Dark Theme Configuration

[Source: architecture.md#Tech Stack - Tailwind CSS]

**Color Palette:**

- Background: #0a0a0a
- Card backgrounds: #1a1a1a
- Primary accent: #f59e0b (amber-500)
- Text: white/gray-400

**Tailwind Classes:**

- `bg-[#0a0a0a]` - Main background
- `text-white` - Primary text
- `text-gray-400` - Secondary text
- `hover:bg-[#f59e0b]` - Accent hover

### Button Specifications

[Source: epic-1-foundation-authentication.md Story 1.5 AC 3, 7, 8]

**Requirements:**

- Minimum height: 48px (touch-friendly)
- Width: Full width of container
- Contrast ratio: 4.5:1 minimum (WCAG 2.1 Level AA)
- Hover state: #f59e0b accent color
- Focus state: Visible ring (ring-2 ring-primary)
- Keyboard activation: Enter and Space keys

**ShadCN Button Component:**

```tsx
<Button
  className="w-full h-14 text-lg"
  variant="outline"
  size="lg"
  onClick={handleClick}
  aria-label="Login as Manager"
>
  Manager
</Button>
```

### Authentication Implementation

[Source: architecture.md#Components - Authentication Service]

**Manager Login Flow:**

```typescript
async function handleManagerLogin() {
  setLoading(true)
  try {
    const user = await signInAsManager()
    authStore.login(user)
    router.push('/manager/dashboard')
  } catch (error) {
    handleError(error, 'Login.handleManagerLogin')
  } finally {
    setLoading(false)
  }
}
```

**Barber Click Flow:**

```typescript
function handleBarberClick() {
  setView('barber-selection') // Local state
  // Stays on /login page, shows barber selection view
}
```

### Loading State

[Source: architecture.md#Architectural Patterns - Optimistic UI]

**Loading Behavior:**

- Display spinner during authentication
- Disable buttons while loading
- Show optimistic navigation (start transition immediately)
- Use Sonner toast for persistent loading indicator

**Implementation:**

```tsx
{
  loading && (
    <div className="flex items-center justify-center">
      <Spinner className="h-6 w-6" />
      <span className="ml-2">Signing in...</span>
    </div>
  )
}
```

### Error Handling

[Source: architecture.md#Error Handling Strategy]

**Error Flow:**

1. Try authentication operation
2. On error, log to console (and Sentry in production)
3. Transform error to user-friendly message
4. Display toast notification using Sonner
5. Re-enable buttons for retry

**Error Messages:**

- Firebase Auth error → "Unable to sign in. Please try again."
- Network error → "You're offline. Please check your connection."
- Unknown error → "An unexpected error occurred. Please try again."

**Implementation:**

```typescript
import { handleError } from '@/lib/utils/error-handler'
import { toast } from 'sonner'

try {
  // Authentication logic
} catch (error) {
  handleError(error, 'LoginPage.handleManagerLogin')
  // handleError shows toast automatically
}
```

### Accessibility Requirements

[Source: epic-1-foundation-authentication.md Story 1.5 AC 7, 8]

**WCAG 2.1 Level AA Compliance:**

- Contrast ratio: 4.5:1 minimum for normal text
- Contrast ratio: 3:1 minimum for large text (18pt+)
- Keyboard navigation: All interactive elements focusable
- Focus indicators: Visible 2px ring on focus
- ARIA labels: Descriptive labels for screen readers

**Testing Tools:**

- Chrome DevTools Lighthouse (Accessibility audit)
- WebAIM Contrast Checker
- Keyboard-only navigation test

### State Management

[Source: architecture.md#Tech Stack - State Management]

**Component State (useState):**

- `view`: 'role-selection' | 'barber-selection' (local state)
- `loading`: boolean (loading indicator)

**Global State (Zustand authStore):**

- Updated after successful authentication
- Stores user profile and role
- Persisted across page reloads (optional)

### Testing

[Source: architecture.md#Testing Strategy]

**Component Tests (Story 1.10):**

```typescript
// tests/component/auth/LoginPage.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import LoginPage from '@/app/login/page';

describe('LoginPage', () => {
  it('renders role selection buttons', () => {
    render(<LoginPage />);
    expect(screen.getByRole('button', { name: /manager/i })).toBeInTheDocument();
    expect(screen.getByRole('button', { name: /barber/i })).toBeInTheDocument();
  });

  it('shows loading state when Manager button clicked', async () => {
    render(<LoginPage />);
    fireEvent.click(screen.getByRole('button', { name: /manager/i }));
    expect(screen.getByText(/signing in/i)).toBeInTheDocument();
  });

  it('redirects to manager dashboard on successful login', async () => {
    // Mock router.push
    const mockPush = vi.fn();
    vi.mock('next/navigation', () => ({ useRouter: () => ({ push: mockPush }) }));

    render(<LoginPage />);
    fireEvent.click(screen.getByRole('button', { name: /manager/i }));

    await waitFor(() => {
      expect(mockPush).toHaveBeenCalledWith('/manager/dashboard');
    });
  });

  it('supports keyboard navigation', () => {
    render(<LoginPage />);
    const managerButton = screen.getByRole('button', { name: /manager/i });

    managerButton.focus();
    expect(document.activeElement).toBe(managerButton);

    fireEvent.keyDown(managerButton, { key: 'Enter' });
    // Verify authentication triggered
  });
});
```

**E2E Tests (Story 1.10):**

```typescript
// tests/e2e/auth.spec.ts
import { test, expect } from '@playwright/test'

test('manager can log in and reach dashboard', async ({ page }) => {
  await page.goto('/login')

  await page.click('button:has-text("Manager")')

  await expect(page).toHaveURL('/manager/dashboard')
  await expect(page.locator('h1')).toContainText('Dashboard')
})

test('login page is keyboard accessible', async ({ page }) => {
  await page.goto('/login')

  await page.keyboard.press('Tab')
  await expect(page.locator('button:has-text("Manager")')).toBeFocused()

  await page.keyboard.press('Enter')
  await expect(page).toHaveURL('/manager/dashboard')
})
```

**Manual Validation Steps:**

1. Verify login page renders at `/login` route
2. Verify dark theme (#0a0a0a background) applied
3. Verify both buttons are visible and styled correctly
4. Click Manager button → verify redirect to `/manager/dashboard`
5. Click Barber button → verify barber selection view appears
6. Test keyboard navigation: Tab, Enter, Space
7. Verify loading spinner appears during authentication
8. Test error handling: Disconnect network, verify toast appears
9. Run contrast checker on all text/button combinations
10. Run Lighthouse accessibility audit (score 100)

## Change Log

| Date       | Version | Description            | Author          |
| ---------- | ------- | ---------------------- | --------------- |
| 2025-10-10 | v1.0    | Initial story creation | PM Agent (John) |

## Dev Agent Record

### Agent Model Used

{To be populated by dev agent}

### Debug Log References

{To be populated by dev agent}

### Completion Notes List

{To be populated by dev agent}

### File List

{To be populated by dev agent}

## QA Results

{To be populated by QA agent}
