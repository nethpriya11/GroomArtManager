# Story 5.1: Inventory Dashboard & UI/UX Overhaul

## Status

Draft

## Story

**As a** manager,
**I want** a redesigned inventory page with a KPI dashboard and an improved table layout,
**so that** I can get a quick overview of inventory health and manage items more efficiently.

## Acceptance Criteria

1.  The inventory management page at `/app/manager/inventory` is updated to include a dashboard section with KPI cards.
2.  KPI cards display: "Total Inventory Value", "Items Low on Stock", and "Out of Stock Items".
3.  "Total Inventory Value" is the sum of `costPrice` \* `stock` for all inventory items.
4.  "Items Low on Stock" is the count of items where `stock` <= `reorderPoint` and `stock` > 0.
5.  "Out of Stock Items" is the count of items where `stock` == 0.
6.  KPI card values update in real-time as inventory changes.
7.  The main inventory list is redesigned as a new `InventoryListTable` component for better readability.
8.  The table includes a "Last Updated" column displaying the timestamp of the last modification.
9.  Rows for items that are low on stock (`stock` <= `reorderPoint`) have a prominent visual cue (e.g., a yellow or red background highlight).
10. All UI elements follow the project's existing design system (ShadCN UI, dark theme).

## Tasks / Subtasks

- [x] **Backend: Create KPI Calculation Logic** (AC: 2, 3, 4, 5, 6)
  - [x] In `hooks/useInventory.ts`, add logic to calculate `totalValue`, `lowStockCount`, and `outOfStockCount` from the `inventoryItems` data.
  - [x] Ensure calculations are memoized with `useMemo` to prevent re-rendering.
  - [x] Verify that the calculations update in real-time when `inventoryItems` data changes.
- [x] **Frontend: Create KPI Card Component** (AC: 2)
  - [x] Create a new reusable component `components/features/common/KPICard.tsx`. [Source: `front-end-spec.md#Component Library / Design System`]
  - [x] The component should accept `title`, `value`, and an optional `icon` as props.
  - [x] Style the card according to the design system (dark background, large value text, descriptive title).
- [x] **Frontend: Build Inventory Dashboard** (AC: 1)
  - [x] In `app/manager/inventory/page.tsx`, create a new dashboard section above the inventory table.
  - [x] Use a grid layout to display the three KPI cards (`KPICard`).
  - [x] Pass the calculated KPI values to the cards.
- [x] **Frontend: Refactor Inventory Table** (AC: 7, 8, 9)
  - [x] Create a new component `components/features/inventory/InventoryListTable.tsx`.
  - [x] Move the existing `<Table>` structure from `page.tsx` into this new component.
  - [x] Add a "Last Updated" `TableHead` and `TableCell` to display a formatted timestamp. (A `lastUpdated` field will need to be added to the `InventoryItem` type and in Firestore).
  - [x] Apply conditional styling to `TableRow` for low-stock items. The row's background should change based on the `item.stock <= item.reorderPoint` condition. [Source: `front-end-spec.md#Key Screen Layouts`]
- [x] **Backend: Update Firestore Data Model** (AC: 8)
  - [x] Add a `lastUpdated` field (Firestore Timestamp) to the `InventoryItem` type in `types/inventory.ts`.
  - [x] Update the `addInventoryItem` and `updateInventoryItem` functions in `lib/firebase/repositories/inventory-repository.ts` to set `lastUpdated: serverTimestamp()` on all create and update operations.
- [x] **Testing**
  - [x] Write unit tests for the KPI calculation logic.
  - [x] Write component tests for `KPICard.tsx` and `InventoryListTable.tsx`.
  - [x] Update E2E tests to verify the dashboard is displayed and the low-stock highlighting works.

## Dev Notes

### Adapting Existing Architecture

This story requires creating new UI elements and logic for the Inventory feature. While the project's architecture documents (`architecture.md`, `front-end-spec.md`) focus on "Services" and "Service Logs", the established patterns should be adapted for "Inventory".

- **Data Models:** A `lastUpdated` field needs to be added to the `InventoryItem` type. This follows the pattern of using Firestore Timestamps seen in the `ServiceLog` model. [Source: `architecture.md#Data Models`]
  ```typescript
  // types/inventory.ts
  export interface InventoryItem {
    id: string
    // ... existing fields
    lastUpdated: Firestore.Timestamp
  }
  ```
- **Component Structure:** New components should be placed in `components/features/inventory/` or `components/features/common/` as appropriate, following the existing project structure. [Source: `architecture.md#Component Architecture`]
- **State Management:** The existing `useInventoryItems` hook should be the source of data for the new KPI calculations. The calculations should be performed in the `app/manager/inventory/page.tsx` component using `useMemo`. [Source: `architecture.md#State Management Architecture`]
- **Styling:** All new components must use ShadCN UI primitives and adhere to the dark theme and color palette defined in the `front-end-spec.md`. Low-stock visual cues should use the "warning" or "error" colors. [Source: `front-end-spec.md#Branding & Style Guide`]

### File Locations

- **KPI Component:** `components/features/common/KPICard.tsx`
- **Inventory Table Component:** `components/features/inventory/InventoryListTable.tsx`
- **Main Page:** `app/manager/inventory/page.tsx` (to be modified)
- **Inventory Hook:** `hooks/useInventory.ts` (to be modified)
- **Inventory Repository:** `lib/firebase/repositories/inventory-repository.ts` (to be modified)
- **Inventory Type Definition:** `types/inventory.ts` (to be modified)

### Technical Constraints

- All new code must be written in TypeScript with strict mode enabled.
- All new components must be responsive and accessible (WCAG 2.1 AA), following the patterns in the `front-end-spec.md`.
- Firestore queries for KPIs must be efficient and should not require new indexes for this story. The calculations will be done client-side based on the full `inventoryItems` list.

## Change Log

| Date       | Version | Description            | Author        |
| ---------- | ------- | ---------------------- | ------------- |
| 2025-10-12 | v1.0    | Initial story creation | BMad SM (Bob) |

## Dev Agent Record

### Agent Model Used

{To be populated by dev agent}

### Debug Log References

{To be populated by dev agent}

### Completion Notes List

{To be populated by dev agent}

### File List

- `app/manager/inventory/page.tsx` (modified)
- `components/features/common/KPICard.tsx` (created)
- `components/features/inventory/InventoryListTable.tsx` (created)
- `types/inventory.ts` (modified)
- `lib/firebase/repositories/inventory-repository.ts` (modified)
- `tests/unit/components/KPICard.test.tsx` (created)
- `tests/unit/components/InventoryListTable.test.tsx` (created)
- `tests/unit/pages/ManagerInventoryPage.test.tsx` (created)

## QA Results

{To be populated by QA agent}
