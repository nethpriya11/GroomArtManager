# Story 1.7: Manager Dashboard Shell

## Status

Draft

## Story

**As a** manager,
**I want** to see a dashboard layout with navigation after logging in,
**so that** I can access different areas of the management system.

## Acceptance Criteria

1. Manager dashboard created at `/manager/dashboard` route (auth-protected)
2. Horizontal navigation bar at top with links: Dashboard, Barbers, Services, Reports
3. Navigation highlights current active page (#f59e0b underline or background)
4. Main content area displays placeholder KPI cards (3 cards: Total Revenue, Total Services, Active Barbers) with "Coming soon" or $0 values
5. "Pending Approvals" section with empty state: "No pending approvals"
6. "Log a Service" section visible but disabled with "Feature coming soon" message
7. Dark theme applied consistently (#0a0a0a background, #1a1a1a cards)
8. Mobile responsive: Navigation collapses to hamburger menu or bottom nav (<768px)
9. Logout button in navigation triggers logout and redirects to `/login`
10. Page accessible only to authenticated users with `role: 'manager'` (middleware redirect if unauthorized)

## Tasks / Subtasks

- [ ] Create manager dashboard route and page (AC: 1, 10)
  - [ ] Create app/manager/dashboard/page.tsx
  - [ ] Implement middleware.ts for auth protection
  - [ ] Add role check: redirect if user.role !== 'manager'
  - [ ] Verify authenticated users only can access route
- [ ] Create horizontal navigation component (AC: 2, 3)
  - [ ] Create components/features/common/Navigation.tsx
  - [ ] Add navigation links: Dashboard, Barbers, Services, Reports
  - [ ] Implement active page highlighting with #f59e0b color
  - [ ] Use Next.js Link component with usePathname for active state
  - [ ] Style with underline or background highlight for active link
- [ ] Create KPI card components (AC: 4)
  - [ ] Create components/features/dashboard/KPICard.tsx
  - [ ] Create 3 KPI cards: Total Revenue, Total Services, Active Barbers
  - [ ] Display placeholder values: $0, 0, 0 or "Coming soon"
  - [ ] Use ShadCN Card component with dark theme (#1a1a1a)
  - [ ] Arrange in responsive grid (3 columns desktop, 1-2 mobile)
- [ ] Create pending approvals section (AC: 5)
  - [ ] Create PendingApprovalsTable component stub
  - [ ] Display empty state: "No pending approvals"
  - [ ] Use ShadCN Table component structure
  - [ ] Add placeholder table headers (ready for future data)
- [ ] Create log service section (AC: 6)
  - [ ] Create ServiceLogForm component stub
  - [ ] Display "Feature coming soon" message
  - [ ] Disable form inputs and submit button
  - [ ] Apply disabled styling (opacity-50, cursor-not-allowed)
- [ ] Apply dark theme styling (AC: 7)
  - [ ] Set page background to #0a0a0a
  - [ ] Set card backgrounds to #1a1a1a
  - [ ] Use Tailwind dark: prefix or default dark theme
  - [ ] Verify all text meets WCAG AA contrast requirements
- [ ] Implement mobile responsive navigation (AC: 8)
  - [ ] Add hamburger menu for screens <768px
  - [ ] Implement mobile menu with ShadCN Sheet or Dropdown
  - [ ] Alternative: Bottom navigation bar for mobile
  - [ ] Test navigation at 768px breakpoint
- [ ] Add logout functionality (AC: 9)
  - [ ] Add logout button to navigation bar
  - [ ] Implement signOut() in auth service
  - [ ] Call Firebase signOut and clear Zustand auth store
  - [ ] Redirect to /login after successful logout
  - [ ] Show loading state during logout

## Dev Notes

### Route Protection Pattern

[Source: architecture.md#Authentication Service]

**Middleware Configuration (middleware.ts):**

```typescript
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
  const user = request.cookies.get('auth-user')?.value

  if (!user) {
    return NextResponse.redirect(new URL('/login', request.url))
  }

  const userData = JSON.parse(user)
  const path = request.nextUrl.pathname

  // Manager routes
  if (path.startsWith('/manager') && userData.role !== 'manager') {
    return NextResponse.redirect(new URL('/login', request.url))
  }

  return NextResponse.next()
}

export const config = {
  matcher: ['/manager/:path*', '/barber/:path*'],
}
```

**Alternative: Server Component Protection:**

- Use server components to check auth in layout.tsx
- Call Firebase Admin SDK to verify token
- Redirect with redirect() from 'next/navigation' if unauthorized

### Component Architecture

[Source: architecture.md#Component Architecture]

**File Locations:**

- Page: `app/manager/dashboard/page.tsx`
- Layout: `app/manager/layout.tsx` (shared navigation)
- Navigation: `components/features/common/Navigation.tsx`
- KPI Cards: `components/features/dashboard/KPICard.tsx`
- Manager Dashboard: `components/features/dashboard/ManagerDashboard.tsx`

**Component Hierarchy:**

```
app/manager/dashboard/page.tsx
└── ManagerDashboard.tsx
    ├── Navigation.tsx (Dashboard, Barbers, Services, Reports, Logout)
    ├── KPICard.tsx × 3 (Revenue, Services, Barbers)
    ├── PendingApprovalsTable.tsx (empty state)
    └── ServiceLogForm.tsx (disabled)
```

### Navigation State Management

[Source: architecture.md#State Management Architecture]

**Active Link Detection:**

```typescript
'use client';
import { usePathname } from 'next/navigation';
import Link from 'next/link';

export function Navigation() {
  const pathname = usePathname();

  const links = [
    { href: '/manager/dashboard', label: 'Dashboard' },
    { href: '/manager/barbers', label: 'Barbers' },
    { href: '/manager/services', label: 'Services' },
    { href: '/manager/reports', label: 'Reports' },
  ];

  return (
    <nav className="flex gap-6">
      {links.map(link => (
        <Link
          key={link.href}
          href={link.href}
          className={`px-3 py-2 ${
            pathname === link.href
              ? 'border-b-2 border-primary text-primary'
              : 'text-muted-foreground hover:text-foreground'
          }`}
        >
          {link.label}
        </Link>
      ))}
    </nav>
  );
}
```

### Dark Theme Configuration

[Source: architecture.md#Tech Stack - Tailwind CSS]

**Theme Colors:**

- Background: `#0a0a0a` (bg-[#0a0a0a] or configure in tailwind.config)
- Cards: `#1a1a1a` (bg-[#1a1a1a])
- Primary accent: `#f59e0b` (text-primary, border-primary)
- Text: Light gray for contrast (text-gray-300, text-gray-100)

**Tailwind Configuration (tailwind.config.ts):**

```typescript
theme: {
  extend: {
    colors: {
      background: '#0a0a0a',
      card: '#1a1a1a',
      primary: '#f59e0b',
    }
  }
}
```

### Mobile Responsive Design

[Source: architecture.md#Component Template]

**Navigation Options for Mobile (<768px):**

**Option 1: Hamburger Menu**

- Use ShadCN Sheet component
- Icon: Menu from lucide-react
- Slide-in drawer from left/right with full navigation links

**Option 2: Bottom Navigation Bar**

- Fixed bottom bar with icon-only navigation
- Better for mobile UX (thumb-friendly)
- Icons: Home, Users, Briefcase, BarChart, LogOut

**Grid Responsiveness:**

```typescript
// KPI Cards grid
className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'

// Mobile: 1 column
// Tablet: 2 columns
// Desktop: 3 columns
```

### Logout Implementation

[Source: architecture.md#Authentication Service]

**Logout Flow:**

```typescript
// lib/services/auth-service.ts
export async function logout() {
  await signOut(auth) // Firebase sign out
  useAuthStore.getState().logout() // Clear Zustand store
  router.push('/login') // Redirect to login
}

// In Navigation component
const handleLogout = async () => {
  try {
    await logout()
    toast.success('Logged out successfully')
  } catch (error) {
    toast.error('Logout failed. Please try again.')
  }
}
```

### Testing

[Source: architecture.md#Testing Strategy]

**Component Tests (Vitest + React Testing Library):**

- Location: `tests/component/dashboard/ManagerDashboard.test.tsx`
- Test navigation renders all links (Dashboard, Barbers, Services, Reports)
- Test active link highlighting (matches current pathname)
- Test KPI cards render with placeholder values
- Test pending approvals empty state display
- Test log service section shows "Feature coming soon"
- Test logout button triggers logout and redirect
- Test mobile responsive navigation (hamburger menu or bottom nav)
- Test dark theme colors applied correctly

**E2E Tests (Playwright):**

- Location: `tests/e2e/auth.spec.ts`
- Test: "Manager can log in and reach dashboard"
  - Login as manager
  - Verify redirect to /manager/dashboard
  - Verify navigation bar displays
  - Verify KPI cards visible
  - Click logout button
  - Verify redirect to /login
- Test: "Unauthorized users redirected from manager routes"
  - Login as barber
  - Navigate to /manager/dashboard
  - Verify redirect to /login or /barber/dashboard

**Example Test:**

```typescript
describe('ManagerDashboard', () => {
  it('renders navigation with all links', () => {
    render(<ManagerDashboard />);

    expect(screen.getByText('Dashboard')).toBeInTheDocument();
    expect(screen.getByText('Barbers')).toBeInTheDocument();
    expect(screen.getByText('Services')).toBeInTheDocument();
    expect(screen.getByText('Reports')).toBeInTheDocument();
  });

  it('highlights active navigation link', () => {
    // Mock usePathname to return '/manager/dashboard'
    render(<Navigation />);

    const dashboardLink = screen.getByText('Dashboard');
    expect(dashboardLink).toHaveClass('border-primary');
  });

  it('displays placeholder KPI cards', () => {
    render(<ManagerDashboard />);

    expect(screen.getByText('Total Revenue')).toBeInTheDocument();
    expect(screen.getByText('Total Services')).toBeInTheDocument();
    expect(screen.getByText('Active Barbers')).toBeInTheDocument();
  });
});

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-10 | v1.0 | Initial story creation | PM Agent (John) |

## Dev Agent Record
### Agent Model Used
{To be populated by dev agent}

### Debug Log References
{To be populated by dev agent}

### Completion Notes List
{To be populated by dev agent}

### File List
{To be populated by dev agent}

## QA Results
{To be populated by QA agent}
```
